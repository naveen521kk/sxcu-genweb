<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script
  src="https://cdn.jsdelivr.net/npm/file-saver@2.0.2/dist/FileSaver.min.js"
  integrity="sha256-u/J1Urdrk3nCYFefpoeTMgI5viU1ujCDu2fXXoSJjhg="
  crossorigin="anonymous"
></script>
<script src="../main.js"></script>
<script>
  $.urlParam = function (name) {
    var results = new RegExp("[\?&]" + name + "=([^&#]*)").exec(
      window.location.href
    );
    if (results == null) {
      return null;
    }
    return decodeURI(results[1]) || 0;
  };
  var jData = `{
              "Name": "",
              "DestinationType": "ImageUploader",
              "RequestURL": "",
              "FileFormName": "image",
              "Arguments": {
              },
              "URL": "$json:url$",
              "ThumbnailURL": "$json:thumb$",
              "DeletionURL": "$json:del_url$"
          }`;
  var tmpData = JSON.parse(jData);
  var subdomain = $.urlParam("subdomain");
  var token = $.urlParam("token");
  var collection = $.urlParam("collection");
  var collection_token = $.urlParam("collection_token");
  var noembed = $.urlParam("noembed");
  if (subdomain === null) {
    console.log("No Subdomain Probaly the first Run.");
  } else {
    if (
      token != undefined ||
      collection != undefined ||
      collection_token != undefined ||
      noembed != undefined
    ) {
      console.log(true);
    } else {
      subdomain = decodeURIComponent(subdomain);
      tmpData.RequestURL = subdomain;
      console.log(tmpData);
      console.log(subdomain);
      var subdomainParse = new URL(subdomain);
      tmpData = fillData(tmpData, (subdomain = subdomain));
      var finalString = JSON.stringify(tmpData, null, "    ");
      console.log(finalString);
      var blob = new Blob([finalString], {
        type: "text/sxcu;charset=utf-8",
      });
      saveAs(blob, tmpData.Name + ".sxcu");
    }
  }
  //window.location.replace(document.referrer);
</script>
